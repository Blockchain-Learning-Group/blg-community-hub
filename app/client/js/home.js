const apiURL = 'http://localhost:8081/'

let web3
let hub
let blgToken
let likes = {}

const listenerEventCallbacks = {
  'LogResourceAdded': resourceAddedCb,
  'LogResourceLiked': resourceLikedCb,
  'LogUserAdded': userAddedCb,
  'LogErrorString': errorStringCb,
  'LogTokensMinted': tokensMintedCb,
  'LogActivated': blgTokenActivatedCb
}

// Ugly contract data for ease, rquired for events!
const HubAddress = '0x848efcfd7c4931d8a2fbd40528b0279f4c6a2223'
const Hub = {
  "contract_name": "Hub",
  "abi": [
    {
      "constant": false,
      "inputs": [
        {
          "name": "_resourceUrl",
          "type": "string"
        }
      ],
      "name": "likeResource",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_resourceUrl",
          "type": "string"
        }
      ],
      "name": "removeResource",
      "outputs": [],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_resourceUrl",
          "type": "string"
        }
      ],
      "name": "addResource",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_userEOA",
          "type": "address"
        },
        {
          "name": "_userIndex",
          "type": "uint256"
        }
      ],
      "name": "removeUser",
      "outputs": [],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "_id",
          "type": "bytes32"
        }
      ],
      "name": "getResourceById",
      "outputs": [
        {
          "name": "",
          "type": "string"
        },
        {
          "name": "",
          "type": "address"
        },
        {
          "name": "",
          "type": "uint256"
        },
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_userEOA",
          "type": "address"
        },
        {
          "name": "_userName",
          "type": "string"
        },
        {
          "name": "_position",
          "type": "string"
        },
        {
          "name": "_location",
          "type": "string"
        }
      ],
      "name": "addUser",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "RESOURCE_REWARD",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "getResourceIds",
      "outputs": [
        {
          "name": "",
          "type": "bytes32[]"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "getAllUsers",
      "outputs": [
        {
          "name": "",
          "type": "address[]"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "LIKE_REWARD",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "_user",
          "type": "address"
        }
      ],
      "name": "getUserData",
      "outputs": [
        {
          "name": "",
          "type": "string"
        },
        {
          "name": "",
          "type": "string"
        },
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "inputs": [
        {
          "name": "_blgToken",
          "type": "address"
        }
      ],
      "payable": false,
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "user",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "resourceUrl",
          "type": "string"
        },
        {
          "indexed": false,
          "name": "blockNumber",
          "type": "uint256"
        }
      ],
      "name": "LogResourceAdded",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "resourceUrl",
          "type": "string"
        }
      ],
      "name": "LogResourceRemoved",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "resourceUrl",
          "type": "string"
        }
      ],
      "name": "LogResourceLiked",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "user",
          "type": "address"
        }
      ],
      "name": "LogUserAdded",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "user",
          "type": "address"
        }
      ],
      "name": "LogUserRemoved",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "errorString",
          "type": "string"
        }
      ],
      "name": "LogErrorString",
      "type": "event"
    }
  ],
  "unlinked_binary": "0x6060604052341561000f57600080fd5b60405160208061196d833981016040528080519150505b60018054600160a060020a03808416600160a060020a0319928316179092556000805433909316929091169190911790555b505b611904806100696000396000f300606060405236156100935763ffffffff60e060020a60003504166319f80daa811461009857806335afb95f146100ca5780638a15309b146100ea57806393d3f7741461011c578063bc8a6f2014610140578063c6361c22146101ee578063d2239ac414610245578063dff836e11461026a578063e2842d79146102d1578063f0f8d4f114610338578063ffc9896b1461035d575b600080fd5b34156100a357600080fd5b6100b660048035602481019101356104c9565b604051901515815260200160405180910390f35b34156100d557600080fd5b6100e860048035602481019101356108e7565b005b34156100f557600080fd5b6100b660048035602481019101356109bf565b604051901515815260200160405180910390f35b341561012757600080fd5b6100e8600160a060020a0360043516602435610ddd565b005b341561014b57600080fd5b610156600435610eb1565b604051600160a060020a0384166020820152604081018390526060810182905260808082528190810186818151815260200191508051906020019080838360005b838110156101b05780820151818401525b602001610197565b50505050905090810190601f1680156101dd5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34156101f957600080fd5b6100b660048035600160a060020a03169060248035808201929081013591604435808201929081013591606435908101910135610ff7565b604051901515815260200160405180910390f35b341561025057600080fd5b6102586112a9565b60405190815260200160405180910390f35b341561027557600080fd5b61027d6112af565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156102bd5780820151818401525b6020016102a4565b505050509050019250505060405180910390f35b34156102dc57600080fd5b61027d61130f565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156102bd5780820151818401525b6020016102a4565b505050509050019250505060405180910390f35b341561034357600080fd5b610258611378565b60405190815260200160405180910390f35b341561036857600080fd5b61037c600160a060020a036004351661137d565b60405180806020018060200180602001848103845287818151815260200191508051906020019080838360005b838110156103c25780820151818401525b6020016103a9565b50505050905090810190601f1680156103ef5780820380516001836020036101000a031916815260200191505b50848103835286818151815260200191508051906020019080838360005b838110156104265780820151818401525b60200161040d565b50505050905090810190601f1680156104535780820380516001836020036101000a031916815260200191505b50848103825285818151815260200191508051906020019080838360005b8381101561048a5780820151818401525b602001610471565b50505050905090810190601f1680156104b75780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390f35b6000806104d46116ab565b6000805433600160a060020a039081169116146105425761053b606060405190810160405280602581526020017f6d73672e73656e64657220213d20626c672c204875622e6c696b655265736f75815260200160d860020a647263652829028152506115ed565b93506108de565b8585604051808383808284378201915050925050506040519081900390206000818152600360205260409081902091945060a090519081016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106175780601f106105ec57610100808354040283529160200191610617565b820191906000526020600020905b8154815290600101906020018083116105fa57829003601f168201915b50505091835250506001820154600160a060020a03166020820152600282015460408201526003808301546060830152600483015460809092019160ff169081111561065f57fe5b600381111561066a57fe5b905250915060005b8260800151600381111561068257fe5b14156106e55761053b606060405190810160405280602b81526020017f5265736f7572636520646f6573206e6f742065786973742c204875622e6c696b815260200160a860020a6a655265736f757263652829028152506115ed565b93506108de565b600054600160a060020a03166020830151600160a060020a0316146107ea57600154600160a060020a03166340c10f196020840151600a60006040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b151561076857600080fd5b6102c65a03f1151561077957600080fd5b50505060405180519150508015156107ea5761053b606060405190810160405280602d81526020017f556e61626c6520746f206d696e7420424c4720746f6b656e732c204875622e6c8152602001609860020a6c696b655265736f757263652829028152506115ed565b93506108de565b5b610801600a83604001519063ffffffff61169116565b6040808401919091526000848152600360205220829081518190805161082b9291602001906116f4565b506020820151600182018054600160a060020a031916600160a060020a03929092169190911790556040820151816002015560608201518160030155608082015160048201805460ff1916600183600381111561088457fe5b02179055509050507ffb2dc9d4587e80c388cc9e4c01453612a8209118190b5676aee635e0e70f548386866040516020808252810182905280604081018484808284378201915050935050505060405180910390a1600193505b50505092915050565b60005433600160a060020a0390811691161461090257600080fd5b60036000838360405180838380828437820191505092505050604051908190039020815260208101919091526040016000908120906109418282611773565b50600181018054600160a060020a03191690556000600282018190556003820155600401805460ff191690557f704eeb74d14225ce76a0b7d5ef93344c05f6b050567e55f8a8b0ab51a840d26c82826040516020808252810182905280604081018484808284378201915050935050505060405180910390a15b5050565b60008060006109cc6116ab565b60015b600160a060020a033316600090815260056020526040902060039081015460ff16908111156109fa57fe5b14610a565761053b606060405190810160405280602581526020017f55736572206973206e6f74206163746976652c204875622e6164645265736f75815260200160d860020a647263652829028152506115ed565b93506108de565b841515610ab85761053b606060405190810160405280602981526020017f496e766c61696420656d707479207265736f757263652c204875622e61646452815260200160b860020a6865736f757263652829028152506115ed565b93506108de565b858560405180838380828437820191505092505050604051908190039020925060005b60008481526003602081905260409091206004015460ff1690811115610afd57fe5b14610b5e5761053b606060405190810160405280602a81526020017f5265736f7572636520616c7265616479206578697374732c204875622e616464815260200160b060020a695265736f757263652829028152506115ed565b93506108de565b60005433600160a060020a03908116911614610c5657600154600160a060020a03166340c10f19336103e860006040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b1515610bd557600080fd5b6102c65a03f11515610be657600080fd5b5050506040518051925050811515610c565761053b606060405190810160405280602c81526020017f556e61626c6520746f206d696e7420424c4720746f6b656e732c204875622e61815260200160a060020a6b64645265736f757263652829028152506115ed565b93506108de565b5b60a06040519081016040528087878080601f0160208091040260200160405190810160405281815292919060208401838380828437505050928452505050600160a060020a03331660208201526000604082015243606082015260800160015b9052600280549192509060018101610ccf83826117bb565b916000526020600020900160005b508490555060008381526003602052604090208190815181908051610d069291602001906116f4565b506020820151600182018054600160a060020a031916600160a060020a03929092169190911790556040820151816002015560608201518160030155608082015160048201805460ff19166001836003811115610d5f57fe5b02179055509050507f413d05b8bb326cef7511810161c97e50e07475497cb0c04dc8b407faf7991ab833878743604051600160a060020a0385168152604081018290526060602082018181529082018490526080820185858082843782019150509550505050505060405180910390a1600193505b50505092915050565b60005433600160a060020a03908116911614610df857600080fd5b6004805482908110610e0657fe5b906000526020600020900160005b8154600160a060020a036101009290920a820219169091558216600090815260056020526040812090610e478282611773565b610e55600183016000611773565b610e63600283016000611773565b50600301805460ff191690557f820cfa068d67f8bd8bb05be4525aca026c8a81dd1925efc320ecd01ab716569f82604051600160a060020a03909116815260200160405180910390a15b5050565b610eb96117e5565b6000806000610ec66116ab565b600086815260036020526040908190209060a090519081016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610f7b5780601f10610f5057610100808354040283529160200191610f7b565b820191906000526020600020905b815481529060010190602001808311610f5e57829003601f168201915b50505091835250506001820154600160a060020a03166020820152600282015460408201526003808301546060830152600483015460809092019160ff1690811115610fc357fe5b6003811115610fce57fe5b90525090508051816020015182604001518360600151929750909550935091505b509193509193565b6000805433600160a060020a039081169116146110515761104a6040805190810160405260208082527f6d73672e73656e64657220213d20626c672c204875622e616464557365722829908201526115ed565b905061129e565b60005b600160a060020a038916600090815260056020526040902060039081015460ff169081111561107f57fe5b146110d85761104a606060405190810160405280602281526020017f5573657220616c7265616479206578697374732c204875622e61646455736572815260200160f060020a612829028152506115ed565b905061129e565b60048054600181016110ea83826117bb565b916000526020600020900160005b8154600160a060020a03808d166101009390930a928302920219161790555060806040519081016040528088888080601f0160208091040260200160405190810160405281815292919060208401838380828437820191505050505050815260200186868080601f0160208091040260200160405190810160405281815292919060208401838380828437820191505050505050815260200184848080601f016020809104026020016040519081016040528181529291906020840183838082843750505092845250506020909101905060015b9052600160a060020a03891660009081526005602052604090208151819080516111fa9291602001906116f4565b506020820151816001019080516112159291602001906116f4565b506040820151816002019080516112309291602001906116f4565b5060608201518160030160006101000a81548160ff0219169083600381111561125557fe5b02179055509050507f187047b56eb20e7a0313254e37dc60b8c1a9d25707114d2caaaee420b2b7ec2388604051600160a060020a03909116815260200160405180910390a15060015b979650505050505050565b6103e881565b6112b76117e5565b600280548060200260200160405190810160405280929190818152602001828054801561130457602002820191906000526020600020905b815481526001909101906020018083116112ef575b505050505090505b90565b6113176117e5565b600480548060200260200160405190810160405280929190818152602001828054801561130457602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161134f575b505050505090505b90565b600a81565b6113856117e5565b61138d6117e5565b6113956117e5565b61139d611845565b600160a060020a0385166000908152600560205260409081902090608090519081016040529081600082018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561145c5780601f106114315761010080835404028352916020019161145c565b820191906000526020600020905b81548152906001019060200180831161143f57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114fe5780601f106114d3576101008083540402835291602001916114fe565b820191906000526020600020905b8154815290600101906020018083116114e157829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115a05780601f10611575576101008083540402835291602001916115a0565b820191906000526020600020905b81548152906001019060200180831161158357829003601f168201915b505050918352505060038281015460209092019160ff16908111156115c157fe5b60038111156115cc57fe5b9052509050805181602001518260400151919550935091505b509193909250565b60007f551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a78260405160208082528190810183818151815260200191508051906020019080838360005b8381101561164e5780820151818401525b602001611635565b50505050905090810190601f16801561167b5780820380516001836020036101000a031916815260200191505b509250505060405180910390a15060005b919050565b6000828201838110156116a057fe5b8091505b5092915050565b60a0604051908101604052806116bf6117e5565b81526020016000600160a060020a031681526020016000815260200160008152602001600060038111156116ef57fe5b905290565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061173557805160ff1916838001178555611762565b82800160010185558215611762579182015b82811115611762578251825591602001919060010190611747565b5b5061176f929150611896565b5090565b50805460018160011615610100020316600290046000825580601f1061179957506117b7565b601f0160209004906000526020600020908101906117b79190611896565b5b50565b8154818355818115116117df576000838152602090206117df918101908301611896565b5b505050565b60206040519081016040526000815290565b8154818355818115116117df576000838152602090206117df918101908301611896565b5b505050565b60206040519081016040526000815290565b60206040519081016040526000815290565b6080604051908101604052806118596117e5565b81526020016118666117e5565b81526020016118736117e5565b815260200160006116ef565b905290565b60206040519081016040526000815290565b61130c91905b8082111561176f576000815560010161189c565b5090565b90565b61130c91905b8082111561176f576000815560010161189c565b5090565b905600a165627a7a723058203588aea0dfa9b26409c714e2286b9ab8509aa9dc28fb26f1092aaa28bd6ccad90029",
  "networks": {
    "1505495332808": {
      "events": {
        "0x413d05b8bb326cef7511810161c97e50e07475497cb0c04dc8b407faf7991ab8": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            },
            {
              "indexed": false,
              "name": "blockNumber",
              "type": "uint256"
            }
          ],
          "name": "LogResourceAdded",
          "type": "event"
        },
        "0xfb2dc9d4587e80c388cc9e4c01453612a8209118190b5676aee635e0e70f5483": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            }
          ],
          "name": "LogResourceLiked",
          "type": "event"
        },
        "0x187047b56eb20e7a0313254e37dc60b8c1a9d25707114d2caaaee420b2b7ec23": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            }
          ],
          "name": "LogUserAdded",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0xe5a3fa537afe3a3d9df53d0e564e103e33440fab",
      "updated_at": 1505495603025
    },
    "1505559944266": {
      "events": {
        "0x413d05b8bb326cef7511810161c97e50e07475497cb0c04dc8b407faf7991ab8": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            },
            {
              "indexed": false,
              "name": "blockNumber",
              "type": "uint256"
            }
          ],
          "name": "LogResourceAdded",
          "type": "event"
        },
        "0xfb2dc9d4587e80c388cc9e4c01453612a8209118190b5676aee635e0e70f5483": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            }
          ],
          "name": "LogResourceLiked",
          "type": "event"
        },
        "0x187047b56eb20e7a0313254e37dc60b8c1a9d25707114d2caaaee420b2b7ec23": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            }
          ],
          "name": "LogUserAdded",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0xbc426bbbf8f4be0d17961c0184be0a85c2de7aaf",
      "updated_at": 1505561467997
    },
    "1505562489127": {
      "events": {
        "0x413d05b8bb326cef7511810161c97e50e07475497cb0c04dc8b407faf7991ab8": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            },
            {
              "indexed": false,
              "name": "blockNumber",
              "type": "uint256"
            }
          ],
          "name": "LogResourceAdded",
          "type": "event"
        },
        "0xfb2dc9d4587e80c388cc9e4c01453612a8209118190b5676aee635e0e70f5483": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            }
          ],
          "name": "LogResourceLiked",
          "type": "event"
        },
        "0x187047b56eb20e7a0313254e37dc60b8c1a9d25707114d2caaaee420b2b7ec23": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            }
          ],
          "name": "LogUserAdded",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0x5944157127e04fdf1c2f96b6d0bc204df9e08451",
      "updated_at": 1505567525215
    },
    "1505568633202": {
      "events": {
        "0x413d05b8bb326cef7511810161c97e50e07475497cb0c04dc8b407faf7991ab8": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            },
            {
              "indexed": false,
              "name": "blockNumber",
              "type": "uint256"
            }
          ],
          "name": "LogResourceAdded",
          "type": "event"
        },
        "0xfb2dc9d4587e80c388cc9e4c01453612a8209118190b5676aee635e0e70f5483": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            }
          ],
          "name": "LogResourceLiked",
          "type": "event"
        },
        "0x187047b56eb20e7a0313254e37dc60b8c1a9d25707114d2caaaee420b2b7ec23": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            }
          ],
          "name": "LogUserAdded",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        },
        "0x704eeb74d14225ce76a0b7d5ef93344c05f6b050567e55f8a8b0ab51a840d26c": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "resourceUrl",
              "type": "string"
            }
          ],
          "name": "LogResourceRemoved",
          "type": "event"
        },
        "0x820cfa068d67f8bd8bb05be4525aca026c8a81dd1925efc320ecd01ab716569f": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "user",
              "type": "address"
            }
          ],
          "name": "LogUserRemoved",
          "type": "event"
        }
      },
      "links": {},
      "address": "0xa2500d8361012c2007cb481ccc8911651bec59eb",
      "updated_at": 1505575663836
    }
  },
  "schema_version": "0.0.5",
  "updated_at": 1505575663836
}

const blgTokenAddress = '0x8b78e231ee2d5551b215f9a482413f69db558c38'
const blg = {
  "contract_name": "BLG",
  "abi": [
    {
      "constant": false,
      "inputs": [
        {
          "name": "_spender",
          "type": "address"
        },
        {
          "name": "_amount",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_from",
          "type": "address"
        },
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_amount",
          "type": "uint256"
        }
      ],
      "name": "transferFrom",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "",
          "type": "address"
        },
        {
          "name": "",
          "type": "address"
        }
      ],
      "name": "allowed_",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "DECIMALS",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "totalSupply_",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "mint",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "active_",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "name": "balances_",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "_owner",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_blgHub",
          "type": "address"
        }
      ],
      "name": "setBLGHub",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "NAME",
      "outputs": [
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "_owner",
          "type": "address"
        },
        {
          "name": "_spender",
          "type": "address"
        }
      ],
      "name": "allowance",
      "outputs": [
        {
          "name": "remaining",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "blgHub_",
      "outputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "blg_",
      "outputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "inputs": [],
      "payable": false,
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "name": "_from",
          "type": "address"
        },
        {
          "indexed": true,
          "name": "_to",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "Transfer",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "name": "_to",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "to",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "value",
          "type": "uint256"
        },
        {
          "indexed": false,
          "name": "totalSupply",
          "type": "uint256"
        }
      ],
      "name": "LogTokensMinted",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "active",
          "type": "bool"
        }
      ],
      "name": "LogActivated",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "errorString",
          "type": "string"
        }
      ],
      "name": "LogErrorString",
      "type": "event"
    }
  ],
  "unlinked_binary": "0x6060604052341561000f57600080fd5b5b60038054600160a060020a03191633600160a060020a03161790556004805460a060020a60ff02191690555b5b610ee48061004c6000396000f300606060405236156100ca5763ffffffff60e060020a600035041663095ea7b381146100cf57806318160ddd1461010557806323b872dd1461012a5780632839e16a146101665780632e0f26251461019d578063324536eb146101c257806340c10f19146101e75780634d7c09dd1461021d5780636ca34ea21461024457806370a082311461027557806395e087fe146102a6578063a3f4df7e146102d9578063a9059cbb14610364578063dd62ed3e1461039a578063f06d87be146103d1578063fc31723014610400575b600080fd5b34156100da57600080fd5b6100f1600160a060020a036004351660243561042f565b604051901515815260200160405180910390f35b341561011057600080fd5b610118610584565b60405190815260200160405180910390f35b341561013557600080fd5b6100f1600160a060020a036004358116906024351660443561058b565b604051901515815260200160405180910390f35b341561017157600080fd5b610118600160a060020a036004358116906024351661081c565b60405190815260200160405180910390f35b34156101a857600080fd5b610118610839565b60405190815260200160405180910390f35b34156101cd57600080fd5b61011861083e565b60405190815260200160405180910390f35b34156101f257600080fd5b6100f1600160a060020a0360043516602435610844565b604051901515815260200160405180910390f35b341561022857600080fd5b6100f1610aca565b604051901515815260200160405180910390f35b341561024f57600080fd5b610118600160a060020a0360043516610ada565b60405190815260200160405180910390f35b341561028057600080fd5b610118600160a060020a0360043516610aec565b60405190815260200160405180910390f35b34156102b157600080fd5b6100f1600160a060020a0360043516610b0b565b604051901515815260200160405180910390f35b34156102e457600080fd5b6102ec610c60565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156103295780820151818401525b602001610310565b50505050905090810190601f1680156103565780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561036f57600080fd5b6100f1600160a060020a0360043516602435610c80565b604051901515815260200160405180910390f35b34156103a557600080fd5b610118600160a060020a0360043581169060243516610d9c565b60405190815260200160405180910390f35b34156103dc57600080fd5b6103e4610da5565b604051600160a060020a03909116815260200160405180910390f35b341561040b57600080fd5b6103e4610db4565b604051600160a060020a03909116815260200160405180910390f35b600080821161049757610490606060405190810160405280602d81526020017f43616e206e6f7420617070726f766520616e20616d6f756e74203c3d20302c208152602001609860020a6c424c472e617070726f7665282902815250610dc3565b905061057e565b600160a060020a03331660009081526001602052604090205482111561051e57610490606060405190810160405280603581526020017f416d6f756e742069732067726561746572207468616e2073656e6465727320628152602001605860020a74616c616e63652c20424c472e617070726f7665282902815250610dc3565b905061057e565b600160a060020a03338116600090815260026020908152604080832093871683529290522054610554908363ffffffff610e6716565b600160a060020a033381166000908152600260209081526040808320938816835292905220555060015b92915050565b6000545b90565b60008082116105f5576105ee606060405190810160405280602f81526020017f43616e6e6f74207472616e7366657220616d6f756e74203c3d20302c20424c478152602001608860020a6e2e7472616e7366657246726f6d282902815250610dc3565b9050610815565b600160a060020a038416600090815260016020526040902054821115610681576105ee606060405190810160405280603c81526020017f46726f6d206163636f756e742068617320616e20696e73756666696369656e7481526020017f2062616c616e63652c20424c472e7472616e7366657246726f6d282900000000815250610dc3565b9050610815565b600160a060020a038085166000908152600260209081526040808320339094168352929052205482111561071a576105ee606060405190810160405280603981526020017f6d73672e73656e6465722068617320696e73756666696369656e7420616c6c6f8152602001603860020a7877616e63652c20424c472e7472616e7366657246726f6d282902815250610dc3565b9050610815565b600160a060020a038416600090815260016020526040902054610743908363ffffffff610e8116565b600160a060020a0380861660009081526001602090815260408083209490945560028152838220339093168252919091522054610786908363ffffffff610e8116565b600160a060020a03808616600090815260026020908152604080832033851684528252808320949094559186168152600190915220546107cc908363ffffffff610e6716565b600160a060020a0380851660008181526001602052604090819020939093559190861690600080516020610e998339815191529085905190815260200160405180910390a35060015b9392505050565b600260209081526000928352604080842090915290825290205481565b601281565b60005481565b60045460009060a060020a900460ff1615156108ad57610490606060405190810160405280602181526020017f424c47206973206e6f7420796574206163746976652c20424c472e6d696e7428815260200160f860020a602902815250610dc3565b905061057e565b60045433600160a060020a039081169116148015906108db575060035433600160a060020a03908116911614155b1561093957610490606060405190810160405280602781526020017f6d73672e73656e64657220213d20626c67487562206f7220626c672c20424c47815260200160c860020a662e6d696e74282902815250610dc3565b905061057e565b6000821161099a57610490606060405190810160405280602781526020017f43616e6e6f74206d696e7420612076616c7565206f66203c3d20302c20424c47815260200160c860020a662e6d696e74282902815250610dc3565b905061057e565b600160a060020a0383161515610a0857610490606060405190810160405280602c81526020017f43616e6e6f74206d696e7420746f6b656e7320746f2061646472657373283029815260200160a060020a6b2c20424c472e6d696e74282902815250610dc3565b905061057e565b600054610a1b908363ffffffff610e6716565b6000908155600160a060020a038416815260016020526040902054610a46908363ffffffff610e6716565b600160a060020a038416600081815260016020526040808220939093555490917f6d69c71ef35e507286bcb03186fe9ebdbf14f6e096ce22d6564de19afd7922b7918691869190518084600160a060020a0316600160a060020a03168152602001838152602001828152602001935050505060405180910390a25060015b92915050565b60045460a060020a900460ff1681565b60016020526000908152604090205481565b600160a060020a0381166000908152600160205260409020545b919050565b60035460009033600160a060020a03908116911614610b7857610b71606060405190810160405280602281526020017f6d73672e73656e64657220213d20626c672c20424c472e736574424c47487562815260200160f060020a61282902815250610dc3565b9050610b06565b600160a060020a0382161515610bf457610b71606060405190810160405280603a81526020017f496e76616c69642068756220616464726573732c20626c67487562203d3d206181526020017f6464726573732830292c20424c472e736574424c474875622829000000000000815250610dc3565b9050610b06565b6004805460a060020a600160a060020a0319909116600160a060020a0385161760a060020a60ff0219161790557fe7261bb649db1e4cfb17b615c73a61fbfc88370a43040abb09b08ca8bd6817dd6001604051901515815260200160405180910390a15060015b919050565b604080519081016040526003815260e860020a62424c4702602082015281565b60045460009060a060020a900460ff161515610cee57610490606060405190810160405280602681526020017f424c47206973206e6f7420796574206163746976652c20424c472e736574424c815260200160d060020a6547487562282902815250610dc3565b905061057e565b600160a060020a033316600090815260016020526040902054610d17908363ffffffff610e8116565b600160a060020a033381166000908152600160205260408082209390935590851681522054610d4c908363ffffffff610e6716565b600160a060020a038085166000818152600160205260409081902093909355913390911690600080516020610e998339815191529085905190815260200160405180910390a35060015b92915050565b60005b92915050565b600454600160a060020a031681565b600354600160a060020a031681565b60007f551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a78260405160208082528190810183818151815260200191508051906020019080838360005b83811015610e245780820151818401525b602001610e0b565b50505050905090810190601f168015610e515780820380516001836020036101000a031916815260200191505b509250505060405180910390a15060005b919050565b600082820183811015610e7657fe5b8091505b5092915050565b600082821115610e8d57fe5b508082035b929150505600ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa165627a7a72305820b8602e1412083ea20a133959a207bdbbcb169e7d515ca6ab329167c082d8f4690029",
  "networks": {
    "1505495332808": {
      "events": {
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_from",
              "type": "address"
            },
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "_value",
              "type": "uint256"
            }
          ],
          "name": "Transfer",
          "type": "event"
        },
        "0x6d69c71ef35e507286bcb03186fe9ebdbf14f6e096ce22d6564de19afd7922b7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "value",
              "type": "uint256"
            },
            {
              "indexed": false,
              "name": "totalSupply",
              "type": "uint256"
            }
          ],
          "name": "LogTokensMinted",
          "type": "event"
        },
        "0xe7261bb649db1e4cfb17b615c73a61fbfc88370a43040abb09b08ca8bd6817dd": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "active",
              "type": "bool"
            }
          ],
          "name": "LogActivated",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0x1e90483c659759b56b372ac1b1dc99660d1a1879",
      "updated_at": 1505495603036
    },
    "1505559944266": {
      "events": {
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_from",
              "type": "address"
            },
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "_value",
              "type": "uint256"
            }
          ],
          "name": "Transfer",
          "type": "event"
        },
        "0x6d69c71ef35e507286bcb03186fe9ebdbf14f6e096ce22d6564de19afd7922b7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "value",
              "type": "uint256"
            },
            {
              "indexed": false,
              "name": "totalSupply",
              "type": "uint256"
            }
          ],
          "name": "LogTokensMinted",
          "type": "event"
        },
        "0xe7261bb649db1e4cfb17b615c73a61fbfc88370a43040abb09b08ca8bd6817dd": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "active",
              "type": "bool"
            }
          ],
          "name": "LogActivated",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0x7fb62fffc113ca92e78e644161e8bb614b4f2084",
      "updated_at": 1505561468009
    },
    "1505562489127": {
      "events": {
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_from",
              "type": "address"
            },
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "_value",
              "type": "uint256"
            }
          ],
          "name": "Transfer",
          "type": "event"
        },
        "0x6d69c71ef35e507286bcb03186fe9ebdbf14f6e096ce22d6564de19afd7922b7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "value",
              "type": "uint256"
            },
            {
              "indexed": false,
              "name": "totalSupply",
              "type": "uint256"
            }
          ],
          "name": "LogTokensMinted",
          "type": "event"
        },
        "0xe7261bb649db1e4cfb17b615c73a61fbfc88370a43040abb09b08ca8bd6817dd": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "active",
              "type": "bool"
            }
          ],
          "name": "LogActivated",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0xad4b713b3059d4c2debf62a149ac26b366a8cd30",
      "updated_at": 1505567525224
    },
    "1505568633202": {
      "events": {
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_from",
              "type": "address"
            },
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "_value",
              "type": "uint256"
            }
          ],
          "name": "Transfer",
          "type": "event"
        },
        "0x6d69c71ef35e507286bcb03186fe9ebdbf14f6e096ce22d6564de19afd7922b7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "name": "_to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "to",
              "type": "address"
            },
            {
              "indexed": false,
              "name": "value",
              "type": "uint256"
            },
            {
              "indexed": false,
              "name": "totalSupply",
              "type": "uint256"
            }
          ],
          "name": "LogTokensMinted",
          "type": "event"
        },
        "0xe7261bb649db1e4cfb17b615c73a61fbfc88370a43040abb09b08ca8bd6817dd": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "active",
              "type": "bool"
            }
          ],
          "name": "LogActivated",
          "type": "event"
        },
        "0x551303dd5f39cbfe6daba6b3e27754b8a7d72f519756a2cde2b92c2bbde159a7": {
          "anonymous": false,
          "inputs": [
            {
              "indexed": false,
              "name": "errorString",
              "type": "string"
            }
          ],
          "name": "LogErrorString",
          "type": "event"
        }
      },
      "links": {},
      "address": "0xbb81484132a0699e46eaa3ef64a03e9579be9ea9",
      "updated_at": 1505575663848
    }
  },
  "schema_version": "0.0.5",
  "updated_at": 1505575663848
}

$(document).ready(() => {
  initializeApp()
})

/**
 * Initialize the app, loading data primarily.
 */
async function initializeApp () {
  await initEtherConnection()
  await initBLGAndHubContracts()
  loadAllUsers()
  loadAllResources()
  createContractListeners(hub)
  createContractListeners(blgToken)
  loadNewsFeed()
}

/**
 * Append the resource html to the table.
 * @param  {String} url  Resource URL.
 * @param  {Address} user  User's EOA address.
 * @param  {Number} timestamp The time this resource was added at.
 */
function appendNewResource (url, user, reputation, blockNumber) {
  // custom id for each resource
  let idUrl = url.replace('https://', '')
  idUrl = idUrl.replace('.', '')
  idUrl = idUrl.replace(/-/g, '')
  idUrl = idUrl.replace(/\//g, '')

  const reputationId = idUrl + 'rep'

  $('#topResources').append(
    '<div class="card mb-3">'
      +'<div class="card-body">'
      + '<h6 class="card-title mb-1">'
        +'<a href="'+ url +'">'
          + url
        + '</a></h6>'
        +'<p class="card-text small">' + user + '</p>'
      +'</div>'
      +'<hr class="my-0"><div class="card-body py-2 small">'
      // +'<a class="mr-3 d-inline-block" id='+reputationId+'>'
      //   +'<strong>'+ reputation +' </strong>'
      // +'</a>'
      // TODO
      // +'<a class="mr-3 d-inline-block" href="" name='+url+' id='+idUrl+'>'
      //   +'<i class="fa fa-fw fa-thumbs-up"></i>Like'
      // +'</a>'
    +'<a class="mr-3 d-inline-block" href="#"></div>'
    +'<div class="card-footer small text-muted">Added at block number: '+ blockNumber +'</div></div>'
  )

  console.log(idUrl)

  $('#' + idUrl).click(function(e) {
    e.preventDefault()

    // Get the user's ip, unable to like same resource continuously
    $.getJSON('http://ipinfo.io', data => {

      if (url in likes && data.ip in likes[url] && likes[url][data.ip]) {
        alert('You have already liked this url, thanks!')

      } else {
        alert('Transaction submitted, thanks!')
        // Do this immediately to eliminate spamming likes
        if (!(url in likes)) {
          likes[url] = {}
        }

        likes[url][data.ip] = true
        resourceLiked(this.name, data.ip)
      }
    })
  })
}

/**
 * Append a new user to the contributors tables.
 * @param  {Array} userData Array of user info
 */
function appendNewUser(userData) {
  $('#participantsTable').append(
    '<tr><td>'
    + userData[0] + '</td><td>' // name
    + userData[1] + '</td><td>' // position
    + userData[2] + '</td><td>' // location
    + userData[3]               // reputation
    + ' BLG </td><</tr>'
  )
}

/**
 * Create listeners for all events of a given contract.
 */
async function createContractListeners (contract) {
  contract.allEvents({ fromBlock: 'latest', toBlock: 'latest' }).watch((err, res) => {
    if (err) {
      console.log(err)

    } else if (res['event']) {
      _event = res['event']
      // Update newsfeed with all events then event specific callback
      updateNewsFeed(res)
      listenerEventCallbacks[_event](res)
    }
  })
}

/*
 Event Callbacks
 */
function blgTokenActivatedCb(res) {
   console.log('blgTokenActivatedCb')
   console.log(res)
 }

function errorStringCb(res) {
   console.log('errorStringCb')
   console.log(res)
 }

async function tokensMintedCb(res) {
  console.log('tokensMintedCb')
  console.log(res)
  // Update balance of user in table
  const userData = await hub.getUserData.call(res.args.to)
  // TODO update cell in table for user that received the tokens
  updateBLGTotalSupply()
}

/**
 * Callback when resource added event is emitted by hub. Append the resource the
 * the resource table
 * @param  {Object} res The event log object.
 */
async function resourceAddedCb(res) {
  // Get the real user name not the address
  const userData = await hub.getUserData.call(res.args.user)
  appendNewResource(res.args.resourceUrl, userData[0], 0, res.args.blockNumber)
  updateBLGTotalSupply()
}

/**
 * Callback when resource liked event is emitted by hub. Update the resource # of likes.
 * @param  {Object} res The event log object.
 */
async function resourceLikedCb(res) {
  console.log('resourceLikedCb')
  console.log(res)

  const url = res.args.resourceUrl

  let idUrl = url.replace('https://', '')
  idUrl = idUrl.replace('.', '')
  idUrl = idUrl.replace(/-/g, '')
  idUrl = idUrl.replace(/\//g, '')

  const reputationId = idUrl + 'rep'

  // Update ui with new like
  const reputation = $('#' + reputationId)
  const currentRep = reputation.text()
  const newRep = Number(currentRep) + 1
  reputation.text(newRep)
}

async function userAddedCb(res) {
  console.log('userAddedCb')
  console.log(res)
  const userData = await hub.getUserData.call(res.args.user)
  userData[3] = 0 // default to 0 blg tokens
  appendNewUser(userData)
}

/**
 * [initBLGAndHubContracts description]
 */
async function initBLGAndHubContracts () {
  hub = await web3.eth.contract(Hub.abi).at(HubAddress)
  blgToken = await web3.eth.contract(blg.abi).at(blgTokenAddress)
  updateBLGTotalSupply()
}

/**
 * Initialize the connection to an ether client.
 */
async function initEtherConnection () {
  // TODO: define public ip to connect to hosted node!
  // Local Dev client connection
  web3 = new Web3(
    new Web3.providers.HttpProvider('http://localhost:8545')
  );

  // Deploy on Kovan testnet via infura, NOTE cannot watch events!
  // web3 = new Web3(
  //   new Web3.providers.HttpProvider('https://kovan.infura.io/thMAdMI5QeIf8dirn63U')
  // );

  console.log('wbe3 Connected? ' + web3.isConnected());
}

/**
 * Get all users within the hub and load into table.
 * TODO: look to get just active users?
 */
async function loadAllUsers () {
  // TODO define this url in a nice format
  const url = 'http://localhost:8081/loadUsers'

  $.ajax({
     url: url,
     data: {
        format: 'json'
     },
     error: err => {
       console.error('error: ' + error)
     },
     success: users => {
       users.sort(sortUsersByReputation);

       for (let i = 0; i < users.length; i++) {
         appendNewUser(users[i])
       }
     },
     type: 'GET'
  });
}

/**
 * Get all resources within the hub and load into table.
 */
async function loadAllResources () {
  // TODO define this url in a nice format
  const url = 'http://localhost:8081/loadResources'

  $.ajax({
     url: url,
     data: {
        format: 'json'
     },
     error: err => {
       console.error('error: ' + error)
     },
     success: resources => {
       // Sort by highest reputation
       resources.sort(sortResourcesByReputation);

       for (let i = 0; i < resources.length; i++) {
        appendNewResource(
          resources[i][0], // url
          resources[i][1], // user name
          resources[i][2], // reputation
          resources[i][3] // block number
        )
       }
     },
     type: 'GET'
  });
}

/**
 * Load newsfeed with 10 latest events.
 */
function loadNewsFeed() {
  const url = 'http://localhost:8081/loadEvents'

  $.ajax({
     url: url,
     data: {
        format: 'json'
     },
     error: err => {
       console.log('error: ' + err)
     },
     success: events => {
       for (let i = 0; i < events.length; i++) {
         updateNewsFeed(events[i])
       }
     },
     type: 'GET'
  });
}

/**
 * Update the resource as it was liked by someone.
 */
async function resourceLiked(resourceUrl, ip) {
  const url = apiURL + 'resourceLiked/' + encodeURIComponent(resourceUrl) + '/' + ip

  $.ajax({
     url: url,
     data: {
        format: 'json'
     },
     error: err => {
       console.error('error: ' + err)
     },
     success: res => {
      if (!(res)) {
        alert('You have already liked this resource, thanks!')
      }
     },
     type: 'POST'
  });
}

/**
 * Sort the 2D array by the reputation column.
 * @param  {[type]} a [description]
 * @param  {[type]} b [description]
 * @return {[type]}   [description]
 */
function sortResourcesByReputation (a, b) {
  if (a[2] === b[2]) {
    return 0;
  } else {
    return (a[2] > b[2]) ? -1 : 1;
  }
}

/**
 * Sort the 2D array by the reputation column.
 * @param  {[type]} a [description]
 * @param  {[type]} b [description]
 * @return {[type]}   [description]
 */
function sortUsersByReputation (a, b) {
  if (a[3] === b[3]) {
    return 0;
  } else {
    return (a[3] > b[3]) ? -1 : 1;
  }
}

/**
 * Update the total supply of blg tokens.
 */
async function updateBLGTotalSupply() {
  const totalBLGSupply = await blgToken.totalSupply.call()
  $('#blgSupply').text('Total Token Supply: ' + totalBLGSupply.toNumber() + ' BLG')
}

/**
 * Prepend a new item to the newsfeed table
 * @param  {[type]} data [description]
 * @return {[type]}      [description]
 */
async function updateNewsFeed(data) {
  let _event = data['event'].replace('Log', '')
  let img
  let args

  let userData
  if (_event === 'UserAdded') {
    img = '<img class="d-flex mr-3 rounded-circle" src="img/userAdded.png" height="55" width="55">'
    userData = await hub.getUserData.call(data.args.user)
    args = 'Name: ' + userData[0] + '</br>Position: ' + userData[1] + '</br>Location: ' + userData[2]

  } else if (_event === 'ResourceAdded') {
    img = '<img class="d-flex mr-3 rounded-circle" src="img/resourceAdded.png" height="55" width="55">'
    userData = await hub.getUserData.call(data.args.user)
    args = data.args.resourceUrl + '</br> Added by: ' + userData[0]

  } else if (_event === 'ResourceLiked') {
    img = '<img class="d-flex mr-3 rounded-circle" src="img/resourceLiked.png" height="55" width="55">'
    args = data.args.resourceUrl + ' liked!'

  } else if (_event === 'TokensMinted') {
    img = '<img class="d-flex mr-3 rounded-circle" src="img/tokensMinted.png" height="55" width="55">'
    userData = await hub.getUserData.call(data.args.to)
    args = '1 BLG token minted!' + '</br> To: ' + userData[0]

  } else if (_event === 'ErrorString') {
    _event = _event.replace('String', '')
    img = '<img class="d-flex mr-3 rounded-circle" src="img/error.png" height="55" width="55">'
    args = '' + data.args.errorString

  } else {
    console.log('Uknown Event caught!: ' + _event)
    return
  }

  $('#newsFeed').prepend(
    '<a href="#" class="list-group-item list-group-item-action">'
      +'<div class="media">'
        + img
        +'<div class="media-body">'
          +'<strong>'+ data['event'].replace('Log', '') +'</strong></br>'
          + args
          +'<div class="text-muted smaller">Transaction: '+ data['transactionHash'].slice(0, 20) +'...</div>'
          +'<div class="text-muted smaller">Mined at block: '+ data['blockNumber'] +'</div>'
        +'</div>'
      +'</div>'
    +'</a>'
  )
}
